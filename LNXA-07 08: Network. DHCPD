
Задание:
На своем компьютере с виртуальной машиной создайте виртуальную сеть, которая будет изолирована от вашей реальной локальной сети.
Подключите к ней вашу существующую виртуальную машину новым интерфейсом.
Настройте на вашей виртуальной машине dhcpd сервер, который будет раздавать сеть 10.10.10.0/24 и фиксировать IP-адрес 10.10.10.220 для клиента с MAC-адресом 00:0c:29:39:c7:81.
Cоздайте новую виртуальную машину, которая подключена только к изолированной виртуальной сети и запустите на ней в Live режиме Ubuntu Desktop, у которой на сетевом интерфейсе выставлен MAC-адрес из пункта выше.
Получите на втором сервере адрес по DHCP и выведите его при помощи команды ip (команду и вывод сохраните).
На проверку отправьте конфигурационный файл dhcdp сервера и сохраненные выводы.

****************************************************************************
Решение
****************************************************************************

Ефошкин Максим Вячеславович
ОТПРАВЛЕНО
29.10.2022 12:22
dnf install dhcp-server
[root@fedora dhcp]# cat /etc/dhcp/dhcpd.conf | grep -v -E '^#|^$'
option domain-name "rebrainme.com";
option domain-name-servers 10.10.10.10;
default-lease-time 600;
max-lease-time 7200;
authoritative;
log-facility local7;
subnet 10.10.10.0 netmask 255.255.255.0 {
  range 10.10.10.100 10.10.10.200;
  option routers 10.10.10.10;
  option broadcast-address 10.10.10.255;
  default-lease-time 600;
  max-lease-time 7200;
}
host 10.10.10.220 {
  hardware ethernet 00:0c:29:39:c7:81;
  fixed-address 10.10.10.220;
}


systemctl status dhcpd
● dhcpd.service - DHCPv4 Server Daemon
     Loaded: loaded (/usr/lib/systemd/system/dhcpd.service; enabled; vendor preset: disabled)
     Active: active (running) since Sat 2022-10-29 11:41:32 MSK; 26s ago
       Docs: man:dhcpd(8)
             man:dhcpd.conf(5)
   Main PID: 2871 (dhcpd)
     Status: "Dispatching packets..."
      Tasks: 1 (limit: 2333)
     Memory: 8.0M
        CPU: 15ms
     CGroup: /system.slice/dhcpd.service
             └─2871 /usr/sbin/dhcpd -f -cf /etc/dhcp/dhcpd.conf -user dhcpd -group dhcpd --no-pid

Oct 29 11:41:32 fedora dhcpd[2871]: Wrote 0 leases to leases file.
Oct 29 11:41:32 fedora dhcpd[2871]: Listening on LPF/enp0s3/08:00:27:ee:fe:f6/10.10.10.0/24
Oct 29 11:41:32 fedora dhcpd[2871]: Sending on   LPF/enp0s3/08:00:27:ee:fe:f6/10.10.10.0/24
Oct 29 11:41:32 fedora dhcpd[2871]: Sending on   Socket/fallback/fallback-net
Oct 29 11:41:32 fedora dhcpd[2871]: Server starting service.
Oct 29 11:41:32 fedora systemd[1]: Started dhcpd.service - DHCPv4 Server Daemon.
Oct 29 11:41:48 fedora dhcpd[2871]: DHCPDISCOVER from 00:0c:29:39:c7:81 via enp0s3
Oct 29 11:41:48 fedora dhcpd[2871]: DHCPOFFER on 10.10.10.220 to 00:0c:29:39:c7:81 via enp0s3
Oct 29 11:41:48 fedora dhcpd[2871]: DHCPREQUEST for 10.10.10.220 (10.10.10.10) from 00:0c:29:39:c>
Oct 29 11:41:48 fedora dhcpd[2871]: DHCPACK on 10.10.10.220 to 00:0c:29:39:c7:81 via enp0s3
~

root@ubuntu:/home/max# ip ad
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:39:c7:81 brd ff:ff:ff:ff:ff:ff
    inet 10.10.10.220/24 brd 10.10.10.255 scope global dynamic noprefixroute enp0s3
       valid_lft 562sec preferred_lft 562sec
    inet6 fe80::bfc2:b998:97a2:839b/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever



ОТВЕТ КУРАТОРА
Алексей Кузнецов (@Hystrix)
ВЫПОЛНЕНО 5
30.10.2022 10:09
Добрый день!

Отличные знание темы и выполнение задания, замечаний и вопросов нет!


*****************************************************************************
Теория
*****************************************************************************


LNXA-07 08: Network. DHCPD
Описание:
Начнем с небольшой теории. DHCP (Dynamic Host Configuration Protocol) — это протокол динамической настройки, который предназначен для настройки хоста, используя команды удаленного сервера. Протокол является клиент-серверным вариантом и имеет свой собственный метод обмена сообщениями. В большинстве случаев сервис используется для того, чтобы присвоить IP-адрес клиентским устройствам, хотя, кроме этого, протокол позволяет передавать и другие даные для настройки узлов, вплоть до указания серверов времени для синхронизации.

Рассмотрим процесс получения IP-адреса. Когда клиент загружается (или хочет присоединиться к сети), он начинает четырехэтапный процесс для получения IP-адреса. Процесс начинается с отправки широковещательного пакета (broadcast) с сообщением DHCPDISCOVER, в котором содержится MAC-адрес узла, тем самым происходит процесс обнаружения доступных серверов DHCP. Так как у клиента еще нет никаких настроек, то в качестве адреса назначения в пакете указывается 255.255.255.255, а адрес источника указывается как 0.0.0.0.

Когда DHCP-сервер получает сообщение DHCPDISCOVER, он резервирует доступный IP-адрес из объявленного пула для выдачи (аренды) клиенту. Сервер также создает запись ARP, состоящую из MAC-адреса клиента и арендованного IP-адреса, а затем отправляет сообщение DHCPOFFER клиенту, уже по unicast, используя MAC-адрес сервера в качестве исходного адреса и MAC-адрес клиента в качестве адреса получателя.

Когда клиент получает DHCPOFFER с сервера, он отправляет обратно сообщение DHCPREQUEST. Это сообщение используется как для получения адреса, так и для продления аренды. В случае, когда у нас идет первоначальный запрос для аренды адреса, DHCPREQUEST служит в качестве уведомления о принятии выбранных сервером параметров и отклонении предложения от других серверов, так как в случае больших корпоративных сетей может использоваться несколько DHCP серверов, и сообщение DHCPREQUEST отправляется в виде широковещательнго пакета, чтобы проинформировать все серверы о принятом предложении.

При получении сообщения DHCPREQUEST сервер проверяет информацию об аренде с помощью ICMP-запроса на этот адрес, чтобы убедиться, что он не используется и создает новую ARP запись для аренды IP-адреса клиента, а затем отвечает одноадресным (unicast) DHCPACK сообщением. Это сообщение является дубликатом DHCPOFFER, за исключением поля типа сообщения. Когда клиент получает сообщение DHCPACK, он регистрирует информацию и выполняет поиск ARP для назначенного адреса. Если ответа на ARP нет, то клиент знает, что адрес IP действителен и начинает его использовать.

В качестве демона в Linux-системах используется решение dhcpd, рассмотрим простейшую настройку для выдачи адресов клиентам. Установка пакета выполняется командой apt install isc-dhcp-server, далее вся конфигурация выполняется в файле /etc/dhcp/dhcpd.conf и имеет такой вид:

option domain-name "example.com";
option domain-name-servers 10.1.1.2;
authoritative;
subnet 10.1.1.0 netmask 255.255.255.0 {
  range 10.1.1.101 10.1.1.200;
  option routers 10.1.1.2;
}
Тем самым мы объявили пул адресов для выдачи клиентам, указали какой DNS-сервер необходимо использовать и сказали, что у нас только один DHCP-сервер в сети.

Полезные ссылки:
ISC DHCP
dhcpd
How to Install a DHCP Server in Ubuntu and Debian


Задание:
Установите DNS сервер BIND на вашей публичной виртуальной машине.
Настройте BIND в роли авторитетного сервера для домена rebrainme.com и задайте на нем отдачу корневой A-записи адреса вашего сервера.
При помощи утилиты host проверьте корректную работу сервера по запросу rebrainme.com.
На проверку отправьте адрес вашего сервера, конфигурационные файлы BIND и DNS зоны, а также выводы вызова команд.

**********************************************************************
Решение
**********************************************************************

Ефошкин Максим Вячеславович
ОТПРАВЛЕНО
28.07.2022 12:54
1. Установите DNS сервер BIND на вашей публичной виртуальной машине.
address: 51.250.31.3
apt install bind9

2. Настройте BIND в роли авторитетного сервера для домена rebrainme.com и задайте на нем отдачу корневой A-записи адреса вашего сервера.
root@epddn2on6mhit99v756j:/etc/bind# cat rebrainme.zone 
; Authoritative data for rebrainme.com zone
;
$TTL 1D
@   IN SOA  epddn2on6mhit99v756j.rebrainme.com   root.epddn2on6mhit99v756j.rebrainme.com. (
                                       111111111      ; serial
                                       1D              ; refresh
                                       1H              ; retry
                                       1W              ; expire
                                       3H )            ; minimum

$ORIGIN         rebrainme.com.
rebrainme.com.            IN      NS      epddn2on6mhit99v756j.rebrainme.com.
rebrainme.com.            IN          A          51.250.31.3
epddn2on6mhit99v756j                     IN      A       127.0.0.1
server                  IN      A       51.250.31.3

; Mail server MX record
rebrainme.com.            IN      MX      10      mail.rebrainme.com.
root@epddn2on6mhit99v756j:/etc/bind# 


Поправил днс
$ vi /etc/resolv.conf

#nameserver 127.0.0.53
options edns0 trust-ad
search auto.internal ru-central1.internal
nameserver 51.250.31.3
root@epddn2on6mhit99v756j:/etc/bind# 

/etc/bind/named.conf
zone "rebrainme.com" IN {
	type master;
	file "/etc/bind/rebrainme.zone";
	
};
root@epddn2on6mhit99v756j:/etc/bind# 

3. При помощи утилиты host проверьте корректную работу сервера по запросу rebrainme.com.
root@epddn2on6mhit99v756j:/etc/bind# host -t A rebrainme.com
rebrainme.com has address 51.250.31.3
root@epddn2on6mhit99v756j:/etc/bind# 
 
ОТВЕТ КУРАТОРА
Алексей Кузнецов (@Hystrix)
ВЫПОЛНЕНО 4
28.07.2022 19:38
Добрый день!

host -t A rebrainme.com
Так запрос идет через резолвер, но не обязательно править его:

/etc/resolv.conf
Можно в утилите host указать на какой сервер направить запрос для проверки.

Опционально: тоже самое для dig (другой синтаксис)

29.07.2022 01:20
ВЫПОЛНЕНО 4
Ефошкин Максим Вячеславович
ОТПРАВЛЕНО
29.07.2022 01:20
[m.efoshkin@MiWiFi-R4A-srv ~]$ host rebrainme 51.250.31.3
Using domain server:
Name: 51.250.31.3
Address: 51.250.31.3#53
Aliases: 

Host rebrainme not found: 5(REFUSED)
[m.efoshkin@MiWiFi-R4A-srv ~]$ 







[m.efoshkin@MiWiFi-R4A-srv ~]$ dig rebrainme.com @51.250.31.3

; <<>> DiG 9.16.21-RH <<>> rebrainme.com @51.250.31.3
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 22256
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 436ce0f58851f8dd0100000062e30b7fd04826585c9b90a1 (good)
;; QUESTION SECTION:
;rebrainme.com.			IN	A

;; ANSWER SECTION:
rebrainme.com.		86400	IN	A	51.250.31.3

;; Query time: 13 msec
;; SERVER: 51.250.31.3#53(51.250.31.3)
;; WHEN: Fri Jul 29 01:19:43 MSK 2022
;; MSG SIZE  rcvd: 86

[m.efoshkin@MiWiFi-R4A-srv ~]$ 


Спасибо за информацию! 

ОТВЕТ КУРАТОРА
Алексей Кузнецов (@Hystrix)
ВЫПОЛНЕНО 4
29.07.2022 08:50
Добрый день!

[m.efoshkin@MiWiFi-R4A-srv ~]$ host rebrainme 51.250.31.3
Using domain server:
Name: 51.250.31.3
Address: 51.250.31.3#53
Aliases: 

Host rebrainme not found: 5(REFUSED)
[m.efoshkin@MiWiFi-R4A-srv ~]$ 
А почему host не нашел запись?

29.07.2022 09:21
ВЫПОЛНЕНО 5
Ефошкин Максим Вячеславович
ОТПРАВЛЕНО
29.07.2022 09:21
опечатка

[m.efoshkin@MiWiFi-R4A-srv ~]$ host rebrainme.com 51.250.31.3
Using domain server:
Name: 51.250.31.3
Address: 51.250.31.3#53
Aliases: 

rebrainme.com has address 51.250.31.3
rebrainme.com mail is handled by 10 mail.rebrainme.com.
[m.efoshkin@MiWiFi-R4A-srv ~]$

ОТВЕТ КУРАТОРА
Алексей Кузнецов (@Hystrix)
ВЫПОЛНЕНО 5
29.07.2022 09:22
Добрый день!

Отличные знание темы и выполнение задания, замечаний и вопросов нет!

************************************************************************
Теория
************************************************************************
LNXA-04 01: DNS. BIND
Описание:
Мы переходим к большой теме DNS-серверов. Начнем с самого распространенного решения, которое используется более чем на 70% серверов во всем мире — BIND. Но сначала немного теории.

Протокол DNS
Сервис доменных имен (DNS) — это стандартный протокол, который помогает пользователям находить веб-сайты и сервисы, используя удобочитаемые адреса. Подобно телефонной книге, которая позволяет вам искать имена людей и узнавать их номера, DNS позволяет вам набирать адрес веб-сайта и автоматически определять IP-адрес для этого ресурса. Например, имя домена rebrainme.com переводится на IP-адрес 5.189.227.77. Но в отличие от телефонной книги записи DNS обычно обновляются, что означает, что IP-адрес сервера может меняться, не затрагивая конечных пользователей. Пользователи продолжают использовать одно и то же доменное имя и автоматически перенаправляются на новый адрес. После того, как вы зарегистрируете новое доменное имя или обновите DNS-серверы на вашем доменном имени, обновление серверов доменных имен по всему миру и возможность доступа к ресурсам обычно занимает около 12-36 часов.

Типы записей
Существует несколько основных типов записей DNS:

Записи сопоставления адресов (A) - записи, которые содержат имя хоста и соответствующий ему адрес IPv4.
Записи адресов IP версии 6 (AAAA) - записи, которые содержат имя хоста и соответствующий ему адрес IPv6.
Записи канонических имен (CNAME) - используются для создания псевдонимов доменных имен. Может использоваться для псевдонима домена к другому домену.
Запись почтового обменника (MX) - указывает почтовый сервер для доменного имени, используемый в протоколе SMTP для маршрутизации электронной почты на нужный почтовый сервер.
Записи сервера имен (NS) - делегирует зону DNS для использования определенного полномочного сервера имен.
Записи указателя обратного просмотра (PTR) - используются для поиска доменных имен на основе IP-адреса.
Запись сертификата (CERT) - хранит сертификаты шифрования, такие как PKIX, SPKI, PGP и т.д.
Расположение службы (SRV) - запись местоположения службы, как MX, Jabber и других протоколов.
Текстовые записи (TXT) - позволяет хранить строковые значения. Может быть использовано для организации какой-то логики в приложениях. В частности при получении сертификата Let's encrypt, вас попросят создать txt-зону с определенным значением, чтобы пройти проверку по dns-запросу
Типы DNS
Авторитативный (авторитетный) DNS-сервис — полностью отвечает за домен, владеет зоной описывающей домен и предоставляет информацию об IP-адресах в ответ на запросы рекурсивных DNS-серверов, является основным источником информации о домене.
Рекурсивный (рекурсор, резолвер) DNS-сервис — обычно клиенты не отправляют запросы напрямую к авторитативным DNS-сервисам. Вместо этого они взаимодействуют с другим DNS-сервисом, который называется преобразователь имен или рекурсивный DNS-сервис. Он не хранит записи DNS, но действует в качестве посредника, который может сделать запрос и вернуть информацию о домене. Также он может хранить информацию о домене в кэше или постоянном хранилище в течение определенного времени, то есть являться кэшируюшим сервисом.
Серверы DNS
Также существует разделение по серверам. Есть понятие главный сервер DNS (он же первичный, он же master, он же primary) — это авторитетный сервер, который хранит главную копию файла данных зоны, сопровождаемую администратором системы.
Вторичный сервер (slave) — тоже является авторитетным, но он копирует главный файл зоны с первичного сервера. Отличие главного от вторичного лишь в том, что главный загружает свою информацию из конфигурационных файлов зоны, а вторичный — получает настройки зон с главного сервера.
В свою очередь, BIND (Berkeley Internet Name Domain) — это набор программных средств, включающий, как уже упомянуто выше, наиболее широко используемое в мире серверное программное обеспечение DNS (Domain Name System).

К ключевым особенностям BIND относят:

BIND является стандартом де-факто для DNS.
BIND используется на миллионах DNS-серверов и известен стабильной и предсказуемой работой.
BIND поддерживает Linux, NetBSD, FreeBSD, OpenBSD, macOS и Windows.
BIND является одним из немногих DNS-серверов, который поддерживает все основные функции DNS именно так, как они описаны в стандарте RFC.
Мы рассмотрим простой вариант установки и настройки в качестве рекурсора, установим сервер, используя команду apt install bind9, конфигурационный файл у нас будет находиться в /etc/bind/named.conf.options, где мы опишем примерно такую конфигурацию:

options {
  directory "/var/cache/bind";

        recursion yes;
        allow-recursion { localhost; allowed; };
        listen-on port 53 { localhost; 192.168.1.1; };
        allow-query { localhost; allowed; };
        allow-transfer { none; };

        forwarders {
                8.8.8.8;
        };

        dnssec-validation auto;

        auth-nxdomain no;    # conform to RFC1035
        listen-on-v6 { none; };
};
Тем самым указав, что сервер работает на адресе 192.168.1.1, является рекурсором и все запросы отправляет на 8.8.8.8.

Для резолва (запроса) записей существует несколько утилит, которыми можно провести диагностику, таких как dig, host, nslookup. Самым простым вариантом является утилита host, использование которой выглядит следующим образом:

❯ host -t mx yandex.ru
yandex.ru mail is handled by 10 mx.yandex.ru.
Таким образом мы запросили MX-запись (адрес почтового сервера) домена yandex.ru.

Полезные ссылки:
https://en.wikipedia.org/wiki/BIND
BIND
Build your own DNS server on Linux

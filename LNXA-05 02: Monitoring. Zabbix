
Задание:
На удаленном сервере произведите установку Zabbix текущей версии из пакетов с доступом из интернета.
Создайте пользователя rebrainme с паролем rebrainme и полным административным доступом.
Создайте группу CPUMonitor, в которой произведите настройку нового элемента данных для cpu-load.
На вашей локальной виртуальной машине установите и настройте Zabbix-agent, а также настройте новый узел сети в Zabbix сервере, прикрепив к нему шаблон CPUMonitor.
Настройте новый триггер по документации на превышение значения 0.5 до Warning и превышение значения 0.9 до High. Проверьте срабатывание триггеров повышением нагрузки.
В качестве ответа пришлите ссылку для доступа к вашей инсталляции Zabbix.

****************************************************************************
Решение
****************************************************************************
Ефошкин Максим Вячеславович
ОТПРАВЛЕНО
16.08.2022 19:52
Установка
address: 51.250.107.100
# Подготовка репозитория
wget https://repo.zabbix.com/zabbix/6.2/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.2-1+ubuntu20.04_all.deb
dpkg -i zabbix-release_6.2-1+ubuntu20.04_all.deb
apt update

Установка
apt install zabbix-server-mysql zabbix-frontend-php zabbix-apache-conf zabbix-sql-scripts zabbix-agent
apt install mysql-server mysql-client

# MySQL
mysql -uroot -p
password
mysql> create database zabbix character set utf8mb4 collate utf8mb4_bin;
mysql> create user zabbix@localhost identified by 'password';
mysql> grant all privileges on zabbix.* to zabbix@localhost;
mysql> quit;

# Создание структуры базы
zcat /usr/share/doc/zabbix-sql-scripts/mysql/server.sql.gz | mysql -uzabbix -p zabbix

vi /etc/zabbix/zabbix_server.conf
DBPassword=password
systemctl restart zabbix-server zabbix-agent apache2


# Configure web interface with 
http://51.250.107.100/zabbix

Creds:
Admin
zabbix
2. Создайте пользователя rebrainme с паролем rebrainme и полным административным доступом.
root@epdh8e035cd83kuol7q2:/usr/lib/systemd/system# useradd -s /bin/bash rebrainme -p rebrainme
root@epdh8e035cd83kuol7q2:/usr/lib/systemd/system# usermod -aG sudo rebrainme

3. Создайте группу CPUMonitor, в которой произведите настройку нового элемента данных для cpu-load.
 groupadd CPUMonitor
 Добавил template.

 
4. На вашей локальной виртуальной машине установите и настройте Zabbix-agent, а также настройте новый узел сети в Zabbix сервере, прикрепив к нему шаблон CPUMonitor.
Локальную виртуалку создал, но не смог подцепить к облаку, поэтому создал вторую вм в облаке.
efoshkin-lnxa-05-02a
address: 51.250.30.216

apt update
apt-get install zabbix-agent
vi /etc/zabbix/zabbix_agent.conf
Server=51.250.107.100

root@epdo3pbqr8biimmp8ufe:/etc/zabbix# systemctl restart zabbix-agent
root@epdo3pbqr8biimmp8ufe:/etc/zabbix# systemctl enable  zabbix-agent


apt install stress
stress --cpu 2 --timeout 60

Учетка для проверки
root@epdo3pbqr8biimmp8ufe:/home/yc-user# useradd -s /bin/bash rebrainme -p rebrainme -G sudo


5. Настройте новый триггер по документации на превышение значения 0.5 до Warning и превышение значения 0.9 до High. Проверьте срабатывание триггеров повышением нагрузки.
НАстроил.

6. В качестве ответа пришлите ссылку для доступа к вашей инсталляции Zabbix.
Zabbix-server
http://51.250.107.100/zabbix

zabbix-agent
51.250.30.216


ОТВЕТ КУРАТОРА
Oleg Avdeev (@oavdeev)
ВЫПОЛНЕНО 5
17.08.2022 10:29
Максим, здравствуйте! С заданием справились отлично, замечаний нет.



*****************************************************************************
Теория
*****************************************************************************


LNXA-05 02: Monitoring. Zabbix
Описание:
Zabbix является Open Source решением для полноценной организации мониторинга «под ключ». Огромным преимуществом этой системы мониторинга является то, что она включает в себя все требуемые элементы — это сбор метрик, отображение и правила алертов (есть, конечно, и еще возможности, но верхнеуровнево это необходимый минимум). Хранение метрик может быть организовано в популярных SQL БД — MySQL / PostgreSQL / SQLite и т.д.).

Сам Zabbix, собственно, состоит из:

Zabbix-server — это сердце системы мониторинга, отвечает за сбор метрик, обработку, анализ и действия согласно правилам оповещения.
Zabbix-server Web UI — написан на PHP, запускается либо через Apache2, либо через PHP-FPM.
Zabbix-agent — демон, который запускается на серверах, где необходимо организовать сбор метрик. Крайне гибок, поддерживает скрипты и отвечает за сбор метрик и передачу их на центральный сервер мониторинга. По умолчанию использует push-модель, то есть сам доставляет метрики на центральный сервер, однако эта модель спорна при больших распределенных системах, так как создает высокую нагрузку на центральный сервер. Разумеется, это поведение на данный момент времени может конфигурироваться, и zabbix может работать по pull-модели.
База данных — используется для хранения собираемых метрик.
Кроме того, для Zabbix существует компонента Zabbix-proxy, которую можно использовать как точку присутствия в каком-то защищенном секторе и отправлять те запросы, которые шли бы от имени Zabbix-proxy, в то время как он будет отвечать Zabbix-server о проделанной работе.

Zabbix работает по модели сбора данных типа Push, то есть подразумевает, что на целевых хостах находятся Zabbix-agents. Они обращаются к Zabbix-server за списком метрик, которые требуется собирать с целевой машины, производят сбор этих метрик и отправляют на сервер.

Целевой единицей Zabbix является хост (host) — это сервер, на котором установлен Zabbix-agent и с которого производится сборка метрик. Важно то, что, кроме установки Zabbix-agent, также требуется добавить хост на самом Zabbix-server, чтобы он начал принимать запросы от агента, либо настроить автоматическое нахождение хостов (discovery).

Следующий уровень организации хостов — это группа (group). Под группой подразумевается набор хостов, который объединяет какая-то логика (к примеру, Linux-сервера или сервера с nginx, или даже и то, и другое — один хост может быть в нескольких группах).

У каждого хоста есть элементы данных (items) — это параметры, которые собираются агентами с серверов. По факту — метрики. Каждая из этих метрик может собираться тем или иным путем — от обычных метрик, которые нативно умеет Zabbix-agent (типа метрик CPU), до кастомных, которые собираются запуском скрипта.

На базе значений метрик может возникнуть срабатывание (trigger), которое может вести к уведомлению (notification) тем или иным образом, в том числе с возможностью описания сценариев эскалации (к примеру, сначала письмо приходит инженеру, спустя какое-то время — руководителю, чтобы уведомление не осталось в непонятном состоянии). Кроме того, срабатывания могут вызывать определенные действия (actions) — это может быть как отправка сообщения, так и какое-то автоматизированное действие силами Zabbix-server.

Чтобы не плодить одинаковые items, в Zabbix существует понятие шаблона (template). Эта сущность позволяет определить шаблоны для items, которые будут заполняться, исходя из параметров прикрепленной ноды (к примеру, получение информации о всех файловых системах хоста). Если же вам требуется подключить статические items, то их можно добавлять к группам и они автоматически будут применяться ко всем хостам, входящим в состав этих групп.

Еще одним плюсом этой системы для русскоязычного сообщества является полностью рускоязычная документация — ведь Zabbix разрабатывается русской компанией.

Популярность этой системы мониторинга также весьма полезна при эксплуатации, так как практически на любое востребованное open-source решение вы с легкостью сможете найти шаблоны скриптов для организации сбора метрик с данных обьектов. В качестве источника метрик могут быть использованы Prometheus-экспортеры (начиная с 4 версии Zabbix).

Полезные ссылки:
Zabbix (official site)
Zabbix (официальная документациия на русском языке)
Универсальная система мониторинга Zabbix — введение (habr)
Установка и настройка Zabbix 4.0
